class Body{constructor(a){this.name=this.hasData(a.name)?a.name:"Unnamed",this.type=this.hasData(a.type)?parseFloat(a.type):4,this.epoch=this.hasData(a.epoch)?parseFloat(a.epoch):51544.5,this.semiMajorAxis=this.hasData(a.a)?parseFloat(a.a):1,this.eccentricity=this.hasData(a.e)?parseFloat(a.e):0,this.inclination=this.hasData(a.inc)?parseFloat(a.inc)*toRad:0,this.w=this.hasData(a.w)?parseFloat(a.w)*toRad:0,this.longAscNode=this.hasData(a.omega)?parseFloat(a.omega)*toRad:0,this.period=Math.pow(this.semiMajorAxis,1.5)/100,this.thetaDot=this.hasData(a.thetaDot)?parseFloat(a.thetaDot)*toRad:0,this.ringRadius=this.hasData(a.ringRadius)?parseFloat(a.ringRadius):0,this.texture=this.hasData(a.texture)?a.texture:"default",this.ringTexture=this.hasData(a.ringTexture)?a.ringTexture:"",this.absoluteMag=this.hasData(a.H)?parseFloat(a.H):10,this.zoomRatio=this.hasData(a.zoomRatio)?parseFloat(a.zoomRatio):1e3,this.radius=this.hasData(a.radius)?parseFloat(a.radius).toFixed(3):estRadius(this.absoluteMag).toFixed(3),this.mass=this.hasData(a.mass)?(1e18*parseFloat(a.mass)).toFixed(3):(87523e5*Math.pow(this.radius,3)).toFixed(3),this.exagRadius=this.radius/AU*exagScale,this.meanOrbit=this.semiMajorAxis*(1+this.eccentricity*this.eccentricity/2),this.periapsis=(1-this.eccentricity)*this.semiMajorAxis,this.apoapsis=(1+this.eccentricity)*this.semiMajorAxis,this.info=this.hasData(a.info)?a.info:"default",this.wiki=this.hasData(a.wiki)?"https://en.wikipedia.org/wiki/"+a.wiki:"default",this.wikipic=this.hasData(a.wikipic)?"https://upload.wikimedia.org/wikipedia/commons/"+a.wikipic:"default",this.axisRA="undefined"==typeof a.axisRA?0:parseFloat(a.axisRA)*toRad,this.axisDec="undefined"==typeof a.axisDec?Math.PI/2:parseFloat(a.axisDec)*toRad,this.path={},this.toSun=0,this.toEarth=0,this.aStart=this.semiMajorAxis,this.eStart=this.eccentricity,this.incStart=this.inclination,this.omegaStart=this.longAscNode}hasData(a){return"undefined"!=typeof a&&0<a.length}phaseIntegral(a){return 2/3*((1-a/Math.PI)*Math.cos(a)+1/Math.PI*Math.sin(a))}}class Planet extends Body{constructor(a){super(a),this.aDot=this.hasData(a.aDot)?parseFloat(a.aDot):0,this.eDot=this.hasData(a.eDot)?parseFloat(a.eDot):0,this.iDot=this.hasData(a.iDot)?parseFloat(a.iDot)*toRad:0,this.meanLongitude=this.hasData(a.l)?parseFloat(a.l)*toRad:0,this.longPeriapsis=this.w,this.argPeriapsis=this.longPeriapsis-this.longAscNode,this.lDot=this.hasData(a.lDot)?parseFloat(a.lDot)*toRad:100,this.wDot=this.hasData(a.wDot)?parseFloat(a.wDot)*toRad:0,this.omegaDot=this.hasData(a.omegaDot)?parseFloat(a.omegaDot)*toRad:0,this.b=this.hasData(a.b)?parseFloat(a.b):0,this.c=this.hasData(a.c)?parseFloat(a.c):0,this.s=this.hasData(a.s)?parseFloat(a.s):0,this.f=this.hasData(a.f)?parseFloat(a.f)*toRad:0,this.phase=this.hasData(a.phase)?parseFloat(a.phase)*toRad:0,this.moons=0,this.largestMoon="",this.largestMoonRadius=0,this.secondMoon="",this.aStart=this.semiMajorAxis,this.eStart=this.eccentricity,this.incStart=this.inclination,this.lStart=this.meanLongitude,this.wStart=this.longPeriapsis,this.omegaStart=this.longAscNode,this.phaseStart=this.phase}set(a){const b=a-MJDToEphTime(this.epoch);this.semiMajorAxis=b*this.aDot+this.aStart,this.eccentricity=b*this.eDot+this.eStart,this.inclination=b*this.iDot+this.incStart,this.meanLongitude=b*this.lDot+this.lStart,this.longPeriapsis=b*this.wDot+this.wStart,this.longAscNode=b*this.omegaDot+this.omegaStart,this.phase=b*this.thetaDot+this.phaseStart}updateOrbit(){this.localOrbit=this.longPoints(this.meanLongitude,this.longPeriapsis,this.eccentricity,this.semiMajorAxis,this.b,this.c,this.s,this.f,orbitPoints),this.celestial=[];for(let a=0;a<this.localOrbit.length;a++)this.celestial.push(celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[a].x,this.localOrbit[a].y));this.celestialPos=this.celestial[0]}update(a){this.meanLongitude+=this.lDot*a,this.localOrbit=this.longPoints(this.meanLongitude,this.longPeriapsis,this.eccentricity,this.semiMajorAxis,this.b,this.c,this.s,this.f),this.celestialPos=celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[0].x,this.localOrbit[0].y)}precess(a){this.semiMajorAxis+=this.aDot*a,this.eccentricity+=this.eDot*a,this.inclination+=this.iDot*a,this.longPeriapsis+=this.wDot*a,this.longAscNode+=this.omegaDot*a}longPoints(a,d,e,g,h,b,c,i,f=1){const j=[],k=2*Math.PI/f;let l=a-d+h*ephTime*ephTime+b*Math.cos(i*ephTime)+c*Math.sin(i*ephTime);for(let m=0;m<f;m++){l+=k;const a=plotPoint(l,e,g,0==m);j.push(a)}return j}}class Asteroid extends Body{constructor(a){super(a),this.catalogNumber=this.hasData(a.num)?parseFloat(a.num):0,this.name=0==this.catalogNumber?this.name:this.catalogNumber+" "+this.name,this.lDot=360/this.period*toRad,this.argPeriapsis=this.w,this.meanAnomaly=this.hasData(a.m)?parseFloat(a.m)*toRad:0,this.phase=0,this.slope=this.hasData(a.G)?parseFloat(a.G):.15,this.classifications=this.sieve(this),this.info="default"==this.info&&0<this.catalogNumber?"Asteroid":this.info,this.wiki="default"==this.wiki&&0<this.catalogNumber&&"Unnamed"!=this.name?"https://en.wikipedia.org/wiki/"+this.name.replace(" ","_"):this.wiki,this.moons=0,this.largestMoon="",this.largestMoonRadius=0,this.secondMoon="",this.mStart=this.meanAnomaly,this.wStart=this.argPeriapsis,this.phaseStart=this.phase}set(a){const b=a-MJDToEphTime(this.epoch);this.meanAnomaly=b*this.lDot+this.mStart,this.phase=this.phaseStart}updateOrbit(){this.localOrbit=this.longPoints(this.meanAnomaly,this.eccentricity,this.semiMajorAxis,orbitPoints),this.celestial=[];for(let a=0;a<this.localOrbit.length;a++)this.celestial.push(celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[a].x,this.localOrbit[a].y));this.celestialPos=this.celestial[0]}update(a){this.meanAnomaly+=this.lDot*a,this.localOrbit=this.longPoints(this.meanAnomaly,this.eccentricity,this.semiMajorAxis),this.celestialPos=celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[0].x,this.localOrbit[0].y)}longPoints(a,b,c,d=1){const e=[],f=2*Math.PI/d;for(let g=0;g<d;g++){a+=f;const d=plotPoint(a,b,c,0==g);e.push(d)}return e}phaseIntegral(c){const d=Math.pow(-3.332*Math.pow(Math.tan(c/2),.631),10),a=Math.pow(-1.862*Math.pow(Math.tan(c/2),1.218),10);return(1-this.slope)*d+this.slope*a}sieve(b){const c=[1,2.5,2.706,2.82,3.03,3.27].findIndex(function(a){return a>b.semiMajorAxis}),a=[.7184,.9833,1.1,29].findIndex(function(a){return a>b.periapsis}),d=[1.78,2,2.25,2.5,2.7,2.8,3.1,3.27,3.7,4.2,5.05,5.4,30,39,40.5,47].findIndex(function(a){return a>b.meanOrbit});return{aN:c,a:["Aten","Apollo","Inner main belt","Middle main belt","Outer main belt"][c],pN:a,p:["Mercury-crosser","Venus-crosser","Amor","Scattered disc object","Detached object"][a],mN:d,m:["Hungaria","Phocaea","Alinda","Pallas","Griqua","Cybele","Hilda","Trojan","Centaur","KBO","Plutino","Cubewano"][d]}}}class Moon extends Body{constructor(a){super(a),this.argPeriapsis=this.w,this.meanAnomaly=this.hasData(a.m)?parseFloat(a.m)*toRad:0,this.phase=0,this.orbiting=this.hasData(a.orbiting)?a.orbiting:"default",this.orbitRef=this.hasData(a.orbitRef)?a.orbitRef:"E",this.orbitRA=this.hasData(a.orbitRA)?parseFloat(a.orbitRA)*toRad:0,this.orbitDec=this.hasData(a.orbitDec)?parseFloat(a.orbitDec)*toRad:90,this.tilt=this.hasData(a.tilt)?parseFloat(a.tilt)*toRad:0,this.period=this.hasData(a.P)?parseFloat(a.P)/daysPerCent:this.period,this.lDot=this.hasData(a.lDot)?parseFloat(a.lDot)*toRad:100,this.exagRadius=this.radius/AU,this.semiMajorAxis/=AU,this.info="default"==this.info?"Moon of "+this.orbiting:this.info,this.orbitId=0,this.mStart=this.meanAnomaly,this.wStart=this.argPeriapsis,this.phaseStart=this.phase}set(a){const b=a-MJDToEphTime(this.epoch);this.meanAnomaly=b*this.lDot+this.mStart,this.phase=this.phaseStart}updateOrbit(){this.localOrbit=this.longPoints(this.meanAnomaly,this.eccentricity,this.semiMajorAxis,orbitPoints),this.celestial=[];for(let a=0;a<this.localOrbit.length;a++)this.planetary=planetary(this.argPeriapsis,this.longAscNode,this.incStart,this.orbitRA,this.orbitDec,this.localOrbit[a].x,this.localOrbit[a].y,this.orbitRef,this.orbitId),this.celestial.push(this.planetary.add(scene.children[system[this.orbitId].childId].position));this.celestialPos=this.celestial[0]}update(a){this.meanAnomaly+=this.lDot*a,this.localOrbit=this.longPoints(this.meanAnomaly,this.eccentricity,this.semiMajorAxis),this.planetaryPos=planetary(this.argPeriapsis,this.longAscNode,this.incStart,this.orbitRA,this.orbitDec,this.localOrbit[0].x,this.localOrbit[0].y,this.orbitRef,this.orbitId),this.celestialPos=this.planetaryPos.add(scene.children[system[this.orbitId].childId].position)}longPoints(a,b,c,d=1){const e=[],f=2*Math.PI/d;for(let g=0;g<d;g++){a+=f;const d=plotPoint(a,b,c,0==g);e.push(d)}return e}}class Comet extends Asteroid{constructor(a){super(a),this.info="default"==this.info?"Periodic comet":this.info,this.periapsis=this.hasData(a.q)?parseFloat(a.q):1,this.periapsisTime=this.hasData(a.Tp)?this.cometDate(a.Tp):unixToMJD(Date.parse("2000-01-01T00:00:00")),this.semiMajorAxis=this.periapsis/(1-this.eccentricity),this.apoapsis=(1+this.eccentricity)*this.semiMajorAxis,this.period=Math.pow(this.semiMajorAxis,1.5)/100,this.lDot=360/this.period*toRad,this.longPeriapsis=this.w,this.argPeriapsis=this.longPeriapsis-this.longAscNode,this.meanAnomaly=this.meanLongitude-this.longPeriapsis,this.incStart=this.inclination,this.wStart=this.longPeriapsis}set(a){const b=a-MJDToEphTime(this.periapsisTime);this.meanLongitude=b*this.lDot+this.wStart,this.phase=this.phaseStart}updateOrbit(){this.localOrbit=this.longPoints(this.meanLongitude,this.longPeriapsis,this.eccentricity,this.semiMajorAxis,orbitPoints),this.celestial=[];for(let a=0;a<this.localOrbit.length;a++)this.celestial.push(celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[a].x,this.localOrbit[a].y));this.celestialPos=this.celestial[0]}update(a){this.meanLongitude+=this.lDot*a,this.localOrbit=this.longPoints(this.meanLongitude,this.longPeriapsis,this.eccentricity,this.semiMajorAxis),this.celestialPos=celestial(this.argPeriapsis,this.longAscNode,this.inclination,this.localOrbit[0].x,this.localOrbit[0].y)}longPoints(a,b,c,d,e=1){const f=[],g=2*Math.PI/e;let h=a-b;for(let j=0;j<e;j++){h+=g;const a=plotPoint(h,c,d,0==j);f.push(a)}return f}cometDate(a){const b=decToMinSec(24*parseFloat(a.substr(8))),c=a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)+"T"+("0"+b.deg.toString().slice(-1))+":"+("0"+b.min.toString().slice(-1))+":"+("0"+b.sec.toString().slice(-1));return unixToMJD(Date.parse(c))}}