function windowResize(){renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(window.devicePixelRatio),camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),bloomComposer.setSize(window.innerWidth,window.innerHeight),finalComposer.setSize(window.innerWidth,window.innerHeight),centerX=.5*window.innerWidth,centerY=.5*window.innerHeight,placeWidgets()}window.addEventListener("resize",windowResize),windowResize(),window.addEventListener("mousemove",onMouseMove);function onMouseMove(a){mousePos.x=a.clientX,mousePos.y=a.clientY}function pauseResume(){speed==pauseRate?speed=lastSpeed:(lastSpeed=speed,speed=pauseRate),rate=rates[speed]}$(document).keydown(function(a){switch(a.keyCode){case 37:slowTime();break;case 39:speedTime();break;case 40:setTime(unixToMJD(Date.now()));break;case 32:pauseResume();break;case 27:""!=clickedLabel&&closeTag(clickedLabel);break;case 38:zoomToggle();break;case 113:$("#inputBox").toggle(300);break;case 115:graticule.visible=!graticule.visible;break;case 119:extraData=!extraData;}rate=rates[speed]});function clickTag(a){1>$("#"+a).length&&makeLabel(a),clickedLabel=$("#"+a),clickedLabel.addClass("active").show(),!1==jQuery.isEmptyObject(lastClickedPlanet)&&(paths[clickedPlanet.path].material=pathMaterials[Math.min(lastClickedPlanet.type,3)]),clickedPlanet=system[a],paths[clickedPlanet.path].material=selectedPathMat,3<system[a].type&&scene.add(paths[clickedPlanet.path]),$("#distToActive").remove(),lastClickedPlanet=clickedPlanet,controls.minDistance=.1;new TWEEN.Tween(controls.target).to({x:clickedPlanet.celestialPos.x,y:clickedPlanet.celestialPos.y,z:clickedPlanet.celestialPos.z},1e3).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){this.to({x:clickedPlanet.celestialPos.x,y:clickedPlanet.celestialPos.y,z:clickedPlanet.celestialPos.z})}).start();$("#info a").attr("href",clickedPlanet.wiki),$("#infohead").html(clickedLabel[0].innerHTML),"default"==clickedPlanet.wikipic?$("#info img").hide():$("#info img").attr("src",clickedPlanet.wikipic).show();const b=clickedPlanet.info;let c="";0<clickedPlanet.moons&&(c="<br><a id=\"moonZoom\">Moons: "+clickedPlanet.moons+" ("+clickedPlanet.largestMoon,c+=1<clickedPlanet.moons?",&nbsp;&nbsp;"+clickedPlanet.secondMoon:"",c+=2<clickedPlanet.moons?", et al.)</a>":")</a>"),$("#planetInfo").html(b+c),$("#moonZoom").click(function(){zoomToggle()});const d=.1>clickedPlanet.semiMajorAxis?(clickedPlanet.semiMajorAxis*AU).toFixed(1)+"&nbsp;km":clickedPlanet.semiMajorAxis.toFixed(4)+"&nbsp;AU";$("#semiMajorAxis").html(d);const e=.01>clickedPlanet.period?(clickedPlanet.period*daysPerCent).toFixed(3)+"&nbsp;days":(100*clickedPlanet.period).toFixed(3)+"&nbsp;years";$("#period").html(e),$("#eccentricity").html(clickedPlanet.eccentricity.toFixed(3)),$("#inclination").html((clickedPlanet.inclination*toDeg).toFixed(2)),$("#radius").html(parseFloat(clickedPlanet.radius).toFixed(1)),$("#absMag").html(clickedPlanet.absoluteMag.toFixed(2)),$("#info").show(300),a==earthID?($("#earthRel").hide(),$("#earth").show()):($("#earthRel").show(),$("#earth").hide())}function updateScale(){for(let a=0;a<majorBodies.length;a++){const b=scene.children[majorBodies[a].childId];b.scale.set(planetScale.f,planetScale.f,planetScale.f),sun.scale.set(planetScale.f,planetScale.f,planetScale.f)}}function zoomIn(){controls.minDistance=1e5*(clickedPlanet.radius/AU);const a=camera.position.clone().sub(clickedPlanet.celestialPos).length(),b=new TWEEN.Tween(controls).to({maxDistance:initMaxDistance/clickedPlanet.zoomRatio},1e3).easing(TWEEN.Easing.Quadratic.InOut).start(),c=new TWEEN.Tween(camera).to({fov:.001},1e3).onUpdate(function(){camera.updateProjectionMatrix()}).easing(TWEEN.Easing.Quadratic.InOut).start(),d=new TWEEN.Tween(planetScale).to({f:1/exagScale},1e3).onUpdate(function(){updateScale()}).onComplete(function(){if(pointMaterial.size=.005,2>clickedPlanet.type){paths[clickedPlanet.path].material=transparentMaterial;for(let a=0;a<moons.length;a++)moons[a].orbitId==clickedPlanet.sysId&&(planetMoons.push(moons[a]),$("#"+moons[a].sysId).show(),scene.children[moons[a].childId].material=pathMaterials[0])}}).easing(TWEEN.Easing.Quadratic.InOut).start()}function zoomOut(){controls.maxDistance=initMaxDistance;const a=camera.position.clone().sub(lastClickedPlanet.celestialPos).length(),b=new TWEEN.Tween(controls).to({minDistance:initMinDistance},1e3).easing(TWEEN.Easing.Quadratic.InOut).start(),c=new TWEEN.Tween(camera).to({fov:initialFOV},1e3).onUpdate(function(){camera.updateProjectionMatrix()}).easing(TWEEN.Easing.Quadratic.InOut).start(),d=new TWEEN.Tween(planetScale).to({f:1},1e3).onStart(function(){pointMaterial.size=initialPoint;for(let a=0;a<paths.length;a++)paths[a].material=paths[a].initMaterial}).onUpdate(function(){updateScale()}).easing(TWEEN.Easing.Quadratic.InOut).start();for(let a=0;a<planetMoons.length;a++)$("#"+planetMoons[a].sysId).hide();planetMoons=[]}function zoomToggle(){const a=clickedPlanet.exagRadius/2e3;following=""!=clickedLabel&&!following,following?zoomIn(a):zoomOut(a)}$("#autocomplete").autocomplete({minLength:2,source:function(a,b){var c=new RegExp($.ui.autocomplete.escapeRegex(a.term),"i");b($.grep(contents,function(a){return c.test(a)}))},select:function(a,b){return""!=clickedLabel&&closeTag(clickedLabel),clickTag(orderedNames.indexOf(b.item.value)),this.value="",!1}}),$(function(){$("#inputBox").accordion({heightStyle:"content"}),placeWidgets(),$("#button, #input").tooltip()});function placeWidgets(){$("#inputBox").position({my:"left top",at:"left top",of:document})}$("#reverse").click(function(){slowTime()}),$("#forward").click(function(){speedTime()}),$("#play").click(function(){pauseResume(),$("#playpause").attr("src",7==speed?"data/play.png":"data/pause.png")}),$("#now").click(function(){setTime(unixToMJD(Date.now()))}),$("#moonBox, #asteroidBox, #cometBox").click(function(){$("#autocomplete")[0].value="";const a=$("#moonBox")[0].checked,b=$("#asteroidBox")[0].checked,c=$("#cometBox")[0].checked;contents=planetNames.concat(a?moonNames:null,b?asteroidNames:null,c?cometNames:null)}),$("#setCoords").click(function(){const a=parseFloat($("#manualLat").val()),b=parseFloat($("#manualLon").val());latitude=90>=Math.abs(a)?a:0,longitude=180>=Math.abs(b)?b:0,displayLatLong(latitude,longitude)}),$("#setTime").click(function(){let a=$("#manualDay").val();a=0<a.length?a:"0101";let b=$("#manualTime").val();b=0<b.length?b:"0000";let c=$("#manualYear").val();const d=Math.min(Math.max(parseFloat(c),-9999),9999);c=0<d?("000"+c).slice(-4):"-00"+("000"+Math.abs(d)).slice(-4);const e=c+"-"+a.substr(0,2)+"-"+a.substr(2,2)+"T"+b.substr(0,2)+":"+b.substr(2,2);setTime(unixToMJD(Date.parse(e)))}),$("#clearSplash").click(function(){$("#splashScreen").hide(300),showSplash=!1}),$("#openSplash").click(function(){showSplash=!0,$("#splashScreen").show(300),$("#clearSplash").css({visibility:"visible"})});function closeTag(a){a.removeClass("active"),a.hasClass("tag3")&&(a.removeClass("tag3"),a.addClass("tag2")),clickedLabel="",paths[clickedPlanet.path].material=pathMaterials[Math.min(clickedPlanet.type,3)],following&&zoomOut(lastClickedPlanet.exagRadius/2e3),following=!1,controls.maxDistance=100;const b=new TWEEN.Tween(controls).to({minDistance:1},1e3).easing(TWEEN.Easing.Quadratic.InOut).start(),c=new TWEEN.Tween(controls.target).to({x:0,y:0,z:0},1e3).easing(TWEEN.Easing.Quadratic.InOut).start();$("#info").hide(300)}